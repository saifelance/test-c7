(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[475],{94085:(e,t,i)=>{"use strict";e.exports=i.p+"images/roboto-700-42_0.png"},32867:(e,t,i)=>{"use strict";var s;i.d(t,{Z:()=>r}),function(e){e[e.None=0]="None",e[e.Queued=1]="Queued",e[e.ForceQueued=2]="ForceQueued",e[e.Downloading=3]="Downloading",e[e.Downloaded=4]="Downloaded",e[e.DownloadFailed=5]="DownloadFailed"}(s||(s={}));const r=s},59855:(e,t,i)=>{"use strict";i.d(t,{t:()=>n});var s=i(17597),r=i(20331),o=i(60771),a=i(17916);const n={urlTemplateToken:"<file>",hideMenu:"1"!==(0,s.eY)("dmenu","0"),debug:"1"===(0,s.eY)("debugTiles","0"),displayBoxBounds:!1,initialMaxLOD:0,maxLOD:(0,s.eY)("maxLOD",a.V.High),loadSiblings:!0,displayActiveTiles:!1,autoDisableRendererCulling:!0,optimizeRaycast:!1,stopAtEmptyTiles:!1,statsTiles:!0,statsTextures:!1,statsTextureStream:!1,errorTarget:Number((0,s.eY)("errorTarget",4)),disableTileUpdates:!1,errorMultiplierRaycastOcclusion:.1,errorMultiplierHiddenFloors:.01,disposeModel:!1,limitMemoryUsage:(0,o.tq)(),allocatedMegsBeforeLimitingLod:350,lruMinExtraTiles:(0,o.tq)()?0:100,lruMaxTiles:800,lruUnloadPercent:.05,tileAssetRequestPriority:r.RequestPriority.MEDIUM,downloadQueueConcurrency:8,parseQueueConcurrency:10,snappingMaxLOD:a.V.Standard}},27079:(e,t,i)=>{"use strict";i.d(t,{I6:()=>PriorityCriteria,at:()=>TilePrioritizer});var s,r=i(2212),o=i(52586),a=i(14844),n=i(32867),h=i(19674),c=i(34369),l=i(37381),u=i(17486),p=i(51263),d=i(57051),f=i(48715),g=i(41862),m=i(12216),y=i(60771),w=i(5087),b=i(82088);!function(e){e[e.None=0]="None",e[e.DirectionalFOV=1]="DirectionalFOV"}(s||(s={}));class PriorityCriteria{constructor(e,t,i,s){this.cameraRot=new r.Quaternion,this.sweep=e,this.cameraPosition=(new r.Vector3).copy(t),this.cameraDir=(new r.Vector3).copy(i),this.upcomingSweeps=s,this.zoomingActive=!1}}const x=(e,t,i=!1)=>{let s=0;if(e&&t)for(const r of t)i&&-1!==e.indexOf(r)||(e.push(r),s++);return s};class TilePrioritizer{constructor(e,t,i,s){this.panoQualityManager=e,this.tilingSettings=t,this.sweepData=i,this.raycaster=s,this.tempQueue=[],this.filterAndPrioritize=(e,t,i)=>{if(!this.priorityCriteria.sweep)return;const s=void 0!==this.priorityCriteria.upcomingSweeps&&null!==this.priorityCriteria.upcomingSweeps,r=this.tempQueue;r.length=0,this.queueTilesForPano(r,i,this.priorityCriteria.sweep,c.AB.BASE);const o=x(e,r,!0);this.currViewQueue[c.SL.BASE].value=o,this.fullPanoQueue[c.SL.BASE].value=o,s?this.queueForRestrictedSweeps(e,i):this.priorityCriteria.viewMode!==w.Ey.Panorama?this.queueForNonPanoViewmode(e,i):this.queueForPanoViewmode(e,t,i),this.tilingSettings.downloadFullPano&&this.queueFullPano(e,i)},this.queueRaycast=(()=>{const e=new r.Vector3;return(t,i)=>{if(this.priorityCriteria.sweep)if(this.priorityCriteria.hoveredSweep)this.queueTilesForPano(t,i,this.priorityCriteria.hoveredSweep,c.AB.BASE);else if(this.raycaster&&this.raycaster.hit){const s=e.copy(this.raycaster.hit.point).sub(this.priorityCriteria.sweep.position),r=this.getSinglePanoInDirection(s),o=this.sweepData.getSweep(r);o&&this.queueTilesForPano(t,i,o,c.AB.BASE)}}})(),this.queueRaycastIntersection=(e,t)=>{if(!this.raycaster||!this.raycaster.hit||!this.meshQuery)return;const i=(0,b.bG)(this.sweepData,!1,this.raycaster.hit.intersection,this.meshQuery),s=i.length>0?i[0].sweep:this.sweepData.getClosestSweep(this.raycaster.hit.point,!0);s&&this.queueTilesForPano(e,t,s,c.AB.BASE)},this.getSweepIdInLocalDirection=(()=>{const e=new r.Vector3;return t=>{const i=this.priorityCriteria.cameraRot,s=e.copy(t).applyQuaternion(i);return this.getSinglePanoInDirection(s)}})(),this.persistentStorage=new u.a,this.maxResolution=e.getNavPanoSize(),this.currViewQueue=C(),this.fullPanoQueue=C(),this.isMobileDevice=(0,y.tq)(),this.priorityCriteria=new PriorityCriteria(null,new r.Vector3(0,0,0),new r.Vector3(0,0,-1))}getQualityQueueSize(e,t){return e===g.v.CurrentView?this.currViewQueue[t].value:this.fullPanoQueue[t].value}makeQueueSubscription(e,t,i){return(e===g.v.CurrentView?this.currViewQueue[t]:this.fullPanoQueue[t]).onChanged(i)}updateCriteria(e,t,i,s){this.priorityCriteria.sweep=e,this.priorityCriteria.cameraPosition.copy(t),this.priorityCriteria.cameraDir.copy(i),this.priorityCriteria.cameraRot.copy(s)}setHoveredSweep(e){this.priorityCriteria.hoveredSweep=e}setUpcomingSweeps(e){this.priorityCriteria.upcomingSweeps=e}clearUpcomingSweeps(){this.priorityCriteria.upcomingSweeps=void 0}setDownloadFOV(e){TilePrioritizer.DIRECTIONAL_FOV=e}queueForRestrictedSweeps(e,t){if(!this.priorityCriteria.upcomingSweeps)return;let i=0;for(const s of this.priorityCriteria.upcomingSweeps)if(i++,this.queueTilesForPano(e,t,s,c.AB.BASE),i>=3)break;this.queueFOVStandardNarrow(e,t),this.queueFOVHighNarrow(e,t)}queueForPanoViewmode(e,t,i){this.queueRaycast(e,i),this.queueFOVStandardNarrow(e,i),this.queueScoredSweeps(e,t,i),this.queueFOVHighNarrow(e,i),this.isMobileDevice||this.queueWASD(e,t,i)}queueForNonPanoViewmode(e,t){this.queueRaycastIntersection(e,t)}queueFOVTiles(e,t,i,s){if(!this.priorityCriteria.sweep)return 0;const r=c.eE[t];return this.canDownloadSize(this.priorityCriteria.sweep,t)?this.queueTilesInDirectionForPano(e,s,this.priorityCriteria.sweep,r,this.priorityCriteria.cameraDir,i):0}queueScoredSweeps(e,t,i){if(this.priorityCriteria.sweep&&this.maxResolution<=2048){const s=this.persistentStorage.getArray("filterAndPrioritize:scoredSweeps");this.populateScoredSweeps(this.priorityCriteria.sweep,t,s,this.priorityCriteria.cameraDir,6),this.queueTilesForPanos(e,s,i,c.AB.BASE,4)}}queueFOVStandardNarrow(e,t){if(!this.priorityCriteria.sweep)return;const i=this.tempQueue;i.length=0;const s=this.queueFOVTiles(i,c.SL.STANDARD,TilePrioritizer.DIRECTIONAL_FOV,t);TilePrioritizer.sortTiles(i,this.priorityCriteria.sweep,this.priorityCriteria.cameraDir),x(e,i),this.currViewQueue[c.SL.STANDARD].value=s,this.fullPanoQueue[c.SL.STANDARD].value=s}queueFOVHighNarrow(e,t){if(!this.priorityCriteria.sweep)return;const i=this.tempQueue;i.length=0;const s=this.queueFOVTiles(i,c.SL.HIGH,TilePrioritizer.DIRECTIONAL_FOV,t),r=this.queueFOVTiles(i,c.SL.ULTRAHIGH,TilePrioritizer.DIRECTIONAL_FOV,t);TilePrioritizer.sortTiles(i,this.priorityCriteria.sweep,this.priorityCriteria.cameraDir),x(e,i),this.currViewQueue[c.SL.HIGH].value=s,this.currViewQueue[c.SL.ULTRAHIGH].value=r}queueFullPano(e,t){if(!this.priorityCriteria.sweep)return;const i=this.tempQueue;if(i.length=0,this.maxResolution<=c.AB.HIGH){if(this.canDownloadSize(this.priorityCriteria.sweep,c.SL.HIGH)){const e=this.queueTilesForPano(i,t,this.priorityCriteria.sweep,c.AB.HIGH);this.fullPanoQueue[c.SL.HIGH].value=e}}else if(this.canDownloadSize(this.priorityCriteria.sweep,c.SL.ULTRAHIGH)){const e=this.queueTilesForPano(i,t,this.priorityCriteria.sweep,c.AB.ULTRAHIGH);this.fullPanoQueue[c.SL.ULTRAHIGH].value=e}TilePrioritizer.sortTiles(i,this.priorityCriteria.sweep,this.priorityCriteria.cameraDir),x(e,i,!0)}queueWASD(e,t,i){const s=this.persistentStorage.getArray("filterAndPrioritize:neighbors")||[];if(s.length=0,!this.priorityCriteria.sweep)return;const r=[m.f.FORWARD,m.f.RIGHT,m.f.LEFT,m.f.BACK];for(const e of r){const i=this.getSweepIdInLocalDirection(e),r=t.get(i);r&&s.push(r)}this.queueTilesForPanos(e,s,i,c.AB.BASE)}canDownloadSize(e,t){const i=c.eE[t],s=this.panoQualityManager.getNavPanoSize()>=i||this.maxResolution>=i&&this.panoQualityManager.getZoomPanoSize()>=i,r=this.panoQualityManager.getTestResults(e.id,t);return s&&r===o.S.Untested&&this.panoQualityManager.testDownload(e,t,a.I_),r===o.S.Success&&s}populateScoredSweeps(e,t,i,s,o){(i=i||[]).length=0;const a=(new r.Vector3).copy(e.position),n=[p._k(),p.ff(e),p.jN(a,400),p.pI(a,s,.75)],h=[d.Dv(a,l.Xd.navigation.distanceFactor),d.o7(a,s,l.Xd.navigation.directionFactor)],c=this.sweepData.getSweepNeighbours(e),u=this.sweepData.sortByScore(n,h,c);for(let e=0;e<u.length&&e<o;e++){const t=u[e].sweep;i.push(t)}}queueTilesForPanos(e,t,i,s,r){let o=0;for(const a of t){if(o+=this.queueTilesForPano(e,i,a,s)>0?1:0,r&&o>=r)break}return o}queueTilesForPano(e,t,i,r){const o=this.persistentStorage.get("queueTilesForSweep:filterCriteria",(()=>({filter:s.None})));return this.filterAndQueueTileDownloadDescriptors(e,t,i,r,o)}queueTilesInDirectionForPano(e,t,i,o,n,h){const c=this.persistentStorage.get("queueTilesInDirectionForSweep:panoSpaceDir",(()=>new r.Vector3)),l=this.persistentStorage.get("queueTilesInDirectionForSweep:filterCriteria",(()=>({filter:s.DirectionalFOV,direction:new r.Vector3,fov:60})));return c.copy(n),a.ym(i.rotation,c),l.direction.copy(c),l.fov=h,this.filterAndQueueTileDownloadDescriptors(e,t,i,o,l)}filterAndQueueTileDownloadDescriptors(e,t,i,s,r){const o=this.persistentStorage.getArray("filterAndQueueTileDownloadDescriptors:descriptors"),a=t.getTileDownloadDescriptors(i,s);o.length=0,this.filterTileDownloadDescriptors(a,o,r);let n=0;for(const t of o)t&&(e.push(t),n++);return n}filterTileDownloadDescriptors(e,t,i){let r,o;switch(i.filter){case s.DirectionalFOV:for(r=0;r<e.length;r++)o=e[r],o&&a.eO(o.panoSize,o.tileSize,o.face,o.tileX,o.tileY,i.direction,i.fov)&&t.push(o);break;default:for(r=0;r<e.length;r++)o=e[r],t.push(o)}for(r=0;r<t.length;r++)o=t[r],o&&!this.canIncludeDescriptor(o)&&(t[r]=null)}canIncludeDescriptor(e){return e.status!==n.Z.Downloading&&e.status!==n.Z.Downloaded}static sortTiles(e,t,i){S.panoSpaceDir.copy(i),a.ym(t.rotation,S.panoSpaceDir),S.fovThresholdNarrow=h.tf(TilePrioritizer.DIRECTIONAL_FOV),e.sort(T)}static insertSortedPanoTile(e,t,i,s){S.panoSpaceDir.copy(s),a.ym(i.rotation,S.panoSpaceDir),S.fovThresholdNarrow=h.tf(TilePrioritizer.DIRECTIONAL_FOV);let r=-1;for(let i=0;i<e.length;i++){if(T(t,e[i])<=0){r=i;break}}if(-1===r)e[e.length]=t;else{for(let t=e.length;t>r;t--)e[t]=e[t-1];e[r]=t}}getSinglePanoInDirection(e){const t=this.priorityCriteria.sweep;if(!t)return"";const i=[p.ff(t),p._k(),p.pI(t.position,e)],s=[d.o7(t.position,e),d.TE(t.position)],r=t.neighbours.filter((e=>{const t=this.sweepData.getSweep(e);return i.every((e=>e(t)))})).map((e=>{const t=this.sweepData.getSweep(e);return{sweepId:e,score:s.reduce(((e,i)=>e+i(t)),0)}})),o=r.reduce(((e,t)=>e.score>t.score?e:t),r[0]);return o?o.sweepId:""}}TilePrioritizer.DIRECTIONAL_FOV=120;const S={panoSpaceDir:new r.Vector3,fovThresholdNarrow:-1},T=(e,t)=>{const i=S.panoSpaceDir,s=S.fovThresholdNarrow,r=Math.max(Math.min(i.dot(e.direction),1),-1),o=Math.max(Math.min(i.dot(t.direction),1),-1);return r>=s&&o<s?-1:r<s&&o>=s||e.panoSize>t.panoSize?1:t.panoSize>e.panoSize?-1:-(r-o)};function C(){return{[c.SL.BASE]:(0,f.Y)(0),[c.SL.STANDARD]:(0,f.Y)(0),[c.SL.HIGH]:(0,f.Y)(0),[c.SL.ULTRAHIGH]:(0,f.Y)(0)}}},15112:(e,t,i)=>{"use strict";i.d(t,{$:()=>Label3D,N:()=>F});var s=i(2212),r=i(7170),o=i(27408);window.THREE=Object.assign(Object.assign({},window.THREE),{BufferGeometry:s.BufferGeometry,Sphere:s.Sphere,Box3:s.Box3,Texture:s.Texture,Color:s.Color,BufferAttribute:s.BufferAttribute});var a=i(11385);var n,h=i(12216),c=i(27687),l=i(17597),u=i(88512);!function(e){e[e.NONE=0]="NONE",e[e.NUMERIC=1]="NUMERIC",e[e.ASCII=2]="ASCII"}(n||(n={}));const p={pages:[],chars:[],info:{face:"Loading",size:0,bold:0,italic:0,charset:[],unicode:1,stretchH:100,smooth:1,aa:1,padding:[0,0,0,0],spacing:[0,0],os2version:1},common:{lineHeight:0,base:0,scaleW:1,scaleH:1,pages:0,packed:0,alphaChnl:0,redChnl:0,greenChnl:0,blueChnl:0},kernings:[]};var d=i(66223),f=i(94085),g=i(23573);class BitmapFontAtlas extends g.T{constructor(e){super(),this.packer=e,this.fontData=p,this.textures=[]}update(e,t){this.fontData=t,this.textures.forEach((e=>e.dispose())),this.textures.length=0,this.textures.push(...e),this.commit()}addCharsIfNeeded(e){this.packer.addChars(e)}}const m=new u.Z("FontManager");class BitmapFontPackerStatic{constructor(){this.name="roboto-700-42-static",this._atlas=new BitmapFontAtlas(this),this.mWidth=0}async loadFont(){const[e,t]=await Promise.all([(0,d.p)(f),i.e(386).then(i.t.bind(i,60386,19))]),s=t.default;return this.estimateWidth(s),this._atlas.update([e],s),Promise.resolve({fontPath:this.name,font:this.name,packer:this})}addChars(e){m.debug(this.name,"does not support dynamic char adding")}measureText(e){if(this.mWidth)return e.length*this.mWidth}atlas(){return this._atlas}estimateWidth(e){const t=e.chars.find((e=>e.id==="m".charCodeAt(0)));t&&(this.mWidth=t.width)}}const y=(()=>{let e=null;return function(){return e||(e=Promise.all([i.e(764),i.e(422),i.e(143)]).then(i.bind(i,44422)).then((e=>e.load))),e}})();var w=i(35995);const b=function(){const e=document.createElement("a");return document.body.appendChild(e),e.style.display="none",(t,i)=>{const s=t.toDataURL();e.href=s,e.download=i,e.click()}}(),x=(e,t)=>{const i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),i.setAttribute("download",t),i.click()};var S=i(62330);const T=new u.Z("font-packer"),C={outlineOffset:Number((0,l.eY)("outlineOffset",.2)),save:"1"===(0,l.eY)("exportfont","0"),saveDefaultFont:"1"===(0,l.eY)("exportdefault","0"),verboseChars:!0,verboseFont:!0,perf:{log:!1,marks:{rebuild:"rebuild",kern:"kerning",metrics:"metrics",pack:"pack",texture:"texture",bmfont:"load-bmfont"}}};class BitmapFontPacker{constructor(e,t){this.needsRebuild=!1,this._atlas=new BitmapFontAtlas(this),this._loading=!1,this._loaded=!1,this._addedChars=[],this.charSet=new Set,this.kerningsMap={},this.measureMap={},this.metricsMap={},this.scale=1,this.throttledRebuild=(0,S.P)((()=>{setTimeout((()=>this.rebuild()),0)}),1500),this.options=e,t&&(this.font=t);try{this.canvas=document.createElement("canvas"),this.canvas.width=this.options.width,this.canvas.height=this.options.height;const e=this.canvas&&this.canvas.getContext("2d");if(!e)throw Error("Unable to create canvas context for font-packer");this.ctx=e,this.ctx.fillStyle="white",this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}catch(e){T.error("Failed to create canvas rendering context",e)}if(this.packer=new w.cC(this.options.width,this.options.height,2*this.options.texturePadding),this.options.defaultCharset){(function(e=!1){const t=new Set(Array.from("m0123456789_-+'\"` \t")),i=[];e&&i.push([32,127]);for(const e of i)for(let i=e[0];i<e[1];i++)t.add(String.fromCharCode(i));return t})(this.options.defaultCharset===n.ASCII||C.saveDefaultFont).forEach((e=>this.charSet.add(e)))}}get loaded(){return!this._loading&&this._loaded}async loadFont(){let e;C.perf.log&&performance.mark(C.perf.marks.bmfont);const t=`${this.options.fontFamily} for BitmapFontPacker`;if(!this.font){this._loading=!0,e=new FontFace(t,`url("${this.options.fontPath}") format("woff")`,{style:`${this.options.fontStyle}`,weight:`${this.options.fontWeight}`}),e.load();const i=e.loaded;document.fonts.add(e);const s=(await y())(this.options.fontPath),[r]=await Promise.all([s,i]);this.font=r}C.perf.log&&performance.measure(C.perf.marks.bmfont,C.perf.marks.bmfont),this.scale=this.options.fontSize/this.font.unitsPerEm;const i=`${this.options.fontWeight} ${this.options.fontSize}px "${t}"`;return this.ctx.font=i,C.verboseFont&&T.debug({contextFontFace:i,bmfont:this.font,charset:this.charSet}),this._loading=!1,this.fontFilename=`${this.options.fontFamily.toLowerCase()}-${this.options.fontWeight}-${this.options.fontSize}`+(this.options.outline?"-outline-"+this.options.outlineWidth:""),this.needsRebuild=!0,this.throttledRebuild(),{fontPath:this.options.fontPath,font:this.font,packer:this}}addChars(e){const t=this.charSet.size;return Array.from(e).forEach((e=>{this.charSet.has(e)||this._addedChars.push(e),this.charSet.add(e)})),t!==this.charSet.size&&(this.needsRebuild=!0,this.throttledRebuild()),this.needsRebuild}atlas(){return this._atlas}rebuild(){if(!this.font)return;if(this.loaded&&this._addedChars.length<1)return void(this.needsRebuild=!1);C.verboseChars&&(T.debug(`Added ${this._addedChars.length} glyphs: \n${this._addedChars}`),this._addedChars.length=0),performance.mark(C.perf.marks.rebuild),C.perf.log&&performance.mark(C.perf.marks.metrics);const e=this.getAllGlyphMetrics();C.perf.log&&performance.measure(C.perf.marks.metrics,C.perf.marks.metrics),C.perf.log&&performance.mark(C.perf.marks.pack);const t=this.pack(e);C.perf.log&&performance.measure(C.perf.marks.pack,C.perf.marks.pack),C.perf.log&&performance.mark(C.perf.marks.texture);const{chars:i,textures:s}=this.assembleTexture(t);C.perf.log&&performance.measure(C.perf.marks.texture,C.perf.marks.texture),C.perf.log&&performance.mark(C.perf.marks.kern);const r=this.getKerningPairs();C.perf.log&&performance.measure(C.perf.marks.kern,C.perf.marks.kern);const o=this.assembleFont(i,r,s);performance.measure(C.perf.marks.rebuild,C.perf.marks.rebuild),this._loaded=!0,this._atlas.update(s,o);const a=`Rebuilt atlas for ${this.charSet.size} chars with ${o.kernings.length} kerning pairs`;C.perf.log?(T.debug(a,performance.getEntriesByName(C.perf.marks.rebuild,"measure")[0],performance.getEntriesByType("measure").map((e=>({name:e.name,duration:e.duration}))),this.options),Object.values(C.perf.marks).forEach((e=>{performance.clearMarks(e),performance.clearMeasures(e)}))):(T.debug(a,performance.getEntriesByName(C.perf.marks.rebuild,"measure")[0]),performance.clearMarks(C.perf.marks.rebuild),performance.clearMeasures(C.perf.marks.rebuild))}pack(e){return this.packer.bins.length=0,this.packer.addArray(e),this.packer.bins.reverse()}assembleTexture(e){const t=[],i=e.map(((e,i)=>(this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.options.transparent&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),e.rects.forEach((e=>{const s=e.data.charData,r=e.x-s.xoffset,o=e.y+s.height+s.ymin-this.options.texturePadding;this.options.outline&&this.options.outlineWidth>0?function(e,t,i,s,r){const o=e.strokeStyle,a=e.fillStyle,n=e.lineJoin,h=e.miterLimit;e.lineJoin="miter",e.miterLimit=2,e.beginPath(),e.strokeStyle="black",e.lineWidth=r,e.strokeText(t,i,s),e.beginPath(),e.fillStyle="white",e.fillText(t,i,s),e.strokeStyle=o,e.fillStyle=a,e.lineJoin=n,e.miterLimit=h}(this.ctx,e.data.charData.char,r,o,this.options.outlineWidth):this.ctx.fillText(e.data.charData.char,r,o),s.x=e.x,s.y=e.y,s.page=i,t.push(e.data.charData)})),C.save&&b(this.ctx.canvas,`${this.fontFilename}_${i}.png`),this.makeCanvasTexture(i,!1))));return{chars:t,textures:i}}getKerningPairs(){const e=[],t=[...this.charSet.values()].map((e=>this.font.charToGlyphIndex(e))).filter((e=>e>0));for(const i of t)for(const s of t){const t=`${i},${s}`;let r=this.kerningsMap[t];if(!r){r={first:i,second:s,amount:this.font.getKerningValue(i,s)*this.scale},this.kerningsMap[t]=r}r&&0!==r.amount&&e.push(r)}return e}assembleFont(e,t,i){const s=this.font.tables.os2,r=this.font.tables.name.fullName,o=r[Object.getOwnPropertyNames(r)[0]],a={pages:i.map(((e,t)=>`${this.fontFilename}_${t}.png`)),chars:e,info:{face:o,size:this.options.fontSize,bold:0,italic:0,charset:[...this.charSet.values()],unicode:1,stretchH:100,smooth:1,aa:1,padding:[0,0,0,0],spacing:[this.options.texturePadding,this.options.texturePadding],os2version:s.version},common:{lineHeight:(s.sTypoAscender-s.sTypoDescender+s.sTypoLineGap)*this.scale,base:this.font.ascender*this.scale,scaleW:this.options.width,scaleH:this.options.height,pages:this.packer.bins.length,packed:0,alphaChnl:0,redChnl:0,greenChnl:0,blueChnl:0},kernings:t};return C.verboseFont&&T.debug({bmFontOutput:a,kerningPairCount:t.length}),C.save&&(x(JSON.stringify(a),`${this.fontFilename}.json`),x(JSON.stringify(this.options,void 0,2),`${this.fontFilename}-pack-options.json`)),a}getMetrics(e){const t=2*this.options.texturePadding,i=this.scale;let s,r,o,a,n,h;const c=this.font.charToGlyph(e),l=0!==c.index;if(l){let t=this.measureMap[e];t||(t=c.getMetrics(),this.measureMap[e]=t),s=(t.xMax-t.xMin)*i,r=(t.yMax-t.yMin)*i,o=t.xMin*i,a=t.yMin*i,n=t.yMax*i,h=c.advanceWidth*i}else{const t=this.measureChar(e);s=t.width,r=t.height,o=t.xMin,a=t.yMin,n=t.yMax,h=s}return{char:e,width:s+t,height:r+t,xmin:o,ymin:a,ymax:n,xadvance:h+(this.options.outline?this.options.outlineWidth*C.outlineOffset:0),supported:l}}measureText(e){if(!this.loaded)return;let t=0;for(const i of Array.from(e)){const{width:e}=this.measureChar(i);t+=e}return t}measureChar(e){let t=this.metricsMap[e];t||(t=this.ctx.measureText(e),this.metricsMap[e]=t);const i=t.actualBoundingBoxLeft+t.actualBoundingBoxRight;return{width:t.width||i,height:t.actualBoundingBoxAscent+t.actualBoundingBoxDescent,xMin:t.actualBoundingBoxLeft,xMax:t.actualBoundingBoxRight,yMin:-t.actualBoundingBoxDescent,yMax:t.actualBoundingBoxAscent}}getAllGlyphMetrics(){const e=[],t=this.font.ascender*this.scale,i=this.options.texturePadding;for(const s of this.charSet.values()){const r=this.getMetrics(s),o={data:{charData:{char:s,id:s.charCodeAt(0),width:r.width,height:r.height,xoffset:r.xmin-i,yoffset:t-r.ymax-i,xadvance:r.xadvance,chnl:15,ymin:r.ymin}},width:r.width,height:r.height};e.push(o)}return e}makeCanvasTexture(e,t){if(t){const e=new Uint8Array(this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height).data),t=new s.DataTexture(e,this.canvas.width,this.canvas.height,s.RGBAFormat);return t.flipY=!0,t}const i=new s.Texture(this.ctx.canvas);return i.name=`${this.ctx.font}_${e}`,i.format=s.RGBAFormat,i.needsUpdate=!0,i}}const D=new u.Z("FontManager"),k={fontPath:"fonts/roboto-700.woff",fontWeight:700,fontFamily:"Roboto",fontStyle:"normal",fontSize:60,width:2048,height:2048,transparent:!0,defaultCharset:n.ASCII,outline:!1,outlineWidth:4,texturePadding:6},v="1"===(0,l.eY)("staticfont","0");class FontManager{constructor(){this.defaultFontOptions=k,this.packerMap=new Map,this.optionsMap=new Map,this.parsedFontMap=new Map}static get instance(){return FontManager._instance||(FontManager._instance=new FontManager),FontManager._instance}getFontId(e=this.defaultFontOptions){const t=Object.assign(Object.assign({},this.defaultFontOptions),e),i=JSON.stringify(t);return this.optionsMap.set(i,t),i}getFont(e){let t=this.packerMap.get(e);if(!t&&v&&(t=new BitmapFontPackerStatic,t.loadFont(),this.packerMap.set(e,t)),!t){const i=this.optionsMap.get(e)||JSON.parse(e),s=this.parsedFontMap.get(i.fontPath);t=new BitmapFontPacker(i,s),this.packerMap.set(e,t),t.loadFont().then((t=>{D.debug("font loaded",e,t.fontPath),this.parsedFontMap.set(t.fontPath,t.font)}))}return t.atlas()}measureText(e,t){const i=this.packerMap.get(e);if(i)return i.measureText(t)}}var F,M=i(69626),A=i(37342);class Label3DMesh extends s.Mesh{}!function(e){e.WORLD="world",e.NDC="ndc"}(F||(F={}));class Label3D extends s.Object3D{constructor(e,t=FontManager.instance,o=F.WORLD){super(),this.config=e,this.fontManager=t,this.scaleType=o,this.update=()=>{const e=this.resolvedConfig;this.textGeometry.update(e),this.textGeometry.computeBoundingBox();const t=this.textGeometry.layout.lineHeight-this.textGeometry.layout.baseline;this.labelTextMesh.position.x=-.5*this.textGeometry.layout.width+t,this.labelTextMesh.position.y=-.5*this.textGeometry.layout.height+t,this.labelTextMesh.position.z=.25,this.unscaledWidth=this.textGeometry.layout.width+this.config.backgroundBorderWidth,this.unscaledHeight=this.textGeometry.layout.height+this.config.backgroundBorderHeight,(this.labelBackgroundMesh||this.config.backgroundAsCollider)&&this.labelBackgroundMesh.scale.set(this.unscaledWidth,this.unscaledHeight,.01),this.aspect=this.unscaledWidth/Math.max(this.unscaledHeight,.001),this.fontHeightToMeters=1/e.font.info.size,this.updateScale(),this._onGeomUpdate&&this._onGeomUpdate()};const n=void 0!==this.config.opacity?this.config.opacity:1;if(this.config.background||this.config.backgroundAsCollider){this.config.backgroundOpacity=void 0!==this.config.backgroundOpacity?this.config.backgroundOpacity:1,this.config.backgroundOpacity=this.config.background?this.config.backgroundOpacity:0;const t=new s.BoxGeometry(1,1,.01),i=new s.MeshBasicMaterial({color:e.backgroundColor,transparent:!0,depthTest:this.config.backgroundOpacity>0&&!e.disableDepth,depthWrite:this.config.backgroundOpacity>0&&!e.disableDepth,opacity:this.config.backgroundOpacity,stencilRef:1,stencilFail:s.KeepStencilOp,stencilZFail:s.KeepStencilOp,stencilZPass:s.ReplaceStencilOp,stencilFunc:s.AlwaysStencilFunc,stencilWrite:!0});this.labelBackgroundMesh=new this.config.backgroundColliderType(t,i),this.labelBackgroundMesh.position.z=-.25,this.labelBackgroundMesh.name="Label Background",this.collider=this.labelBackgroundMesh,this.add(this.labelBackgroundMesh)}const c={outline:this.config.outline,outlineWidth:this.config.outlineWidth},l={uniforms:{map:{type:"t",value:(u=Object.assign(Object.assign({},c),{color:e.color,opacity:n})).map},color:{type:"c",value:new s.Color(u.color)},opacity:{type:"f",value:u.opacity}},vertexShader:i(60948),fragmentShader:i(45576)};var u;const p=new s.RawShaderMaterial({uniforms:l.uniforms,fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,side:s.DoubleSide,transparent:!0,depthTest:!1,depthWrite:!1,opacity:n});p.name="Label Text",this.fontId=this.fontManager.getFontId(c);const d=this.fontManager.getFont(this.fontId);p.uniforms.map.value=d.textures[0],d.onChanged((()=>{p.uniforms.map.value=d.textures[0],this.update()}));const f=this.resolvedConfig,g=f.font;this.textGeometry=a(f),this.labelTextMesh=new Label3DMesh(this.textGeometry,p),this.labelTextMesh.name="Label Text",this.labelTextMesh.renderOrder=10;const m=(new s.Quaternion).setFromAxisAngle(h.f.FORWARD,(0,r.Id)(180)),y=(new s.Quaternion).setFromAxisAngle(h.f.UP,(0,r.Id)(180));this.labelTextMesh.quaternion.multiply(m).multiply(y),this.add(this.labelTextMesh),this.name="Label Container",this.fontHeightToMeters=1/g.info.size,this.scaleFactor=e.scale||this.fontHeightToMeters,this.update()}get resolvedConfig(){let e;if(void 0!==this.config.wordWrapWidth){const t=this.fontManager.measureText(this.fontId,this.config.text);void 0!==t&&t>this.config.wordWrapWidth&&(e=this.config.wordWrapWidth)}const t=this.fontManager.getFont(this.fontId);return Object.assign(Object.assign({},this.config),{font:t.fontData,texture:t.textures[0],width:e})}onGeomUpdate(e){this._onGeomUpdate=e}updateScale(){const e=this.config.scale*this.fontHeightToMeters;this.scale.set(e,e,e)}get text(){return this.config.text}set text(e){e!==this.name&&(this.config.text=e,this.name=e,this.fontManager.getFont(this.fontId).addCharsIfNeeded(e),this.update())}get mesh(){return this.labelTextMesh}get scaleFactor(){return this.config.scale}set scaleFactor(e){this.scaleFactor!==e&&(this.config.scale=e,this.updateScale())}get opacity(){return void 0!==this.config.opacity?this.config.opacity:1}set opacity(e){if(e!==this.config.opacity){this.config.opacity=e;const t=e>0&&!this.config.disableDepth;if(this.config.background){const i=this.labelBackgroundMesh.material;i.opacity=Math.min(this.config.backgroundOpacity||1,e),i.depthWrite=e>A.iV.DEPTH_WRITE_THRESHOD,i.depthTest=t}const i=this.labelTextMesh.material;i.uniforms.opacity.value=e,i.depthTest=t,this.visible=e>0}}setColorHex(e){const t=this.labelTextMesh.material.uniforms.color;t.value.getHex()!==e&&t.value.setHex(e)}setRenderLayer(e){this.labelTextMesh.layers.mask=e.mask,this.labelBackgroundMesh&&(this.labelBackgroundMesh.layers.mask=e.mask)}setRenderOrder(e){this.renderOrder=e,this.labelTextMesh.renderOrder=e,this.labelBackgroundMesh&&(this.labelBackgroundMesh.renderOrder=e)}setPosition(e,t=(e=>e)){this.position.copy(t(e))}setOrientation(e,t=0){this.quaternion.copy(e),0!==t&&this.rotateZ(-t*r.Ue)}scaleBillboard(e,t,i,s,r,a,n=P.SCALE_DEFAULT){if(0!==i.elements[15])this.scaleFactor=.2*n*s*(P.ORTHO_IDEAL_HEIGHT/r);else{const h=(0,c.D_)(this.position,e,t,i.asThreeMatrix4()),l=Math.abs(h.x);if(l<1){const t=(0,M.mY)(i,e,this.position,r,n),h=((0,o.uZ)(a,1,2.5)+s)*P.SCALE_ASPECT,c=1+P.SCALE_NDC-l*P.SCALE_NDC-h,u=Math.max(Math.min(1/t*c,3),.001);this.scaleType===F.NDC?this.scaleFactor=u:this.scaleFactor=Math.min(u*P.NDC_MULT,n*P.SCALE_WORLD)}else this.scaleFactor=.001}this.updateScale()}}const P={SCALE_DEFAULT:.1,SCALE_WORLD:Number((0,l.eY)("scale_world",4)),SCALE_NDC:.5,SCALE_ASPECT:.035,DEPTH_WRITE_THRESHOD:.15,ORTHO_IDEAL_HEIGHT:1500,NDC_MULT:1.15}},42530:(e,t,i)=>{"use strict";i.d(t,{u:()=>Label3DFactory});var s=i(15112),r=i(2212);class Label3DFactory{constructor(e){this.currentTextConfig=Label3DFactory.defaultTextConfig,e?this.updateTextStyle(e):this.updateTextStyle(Label3DFactory.defaultTextConfig)}updateTextStyle(e){this.currentTextConfig=Object.assign(Object.assign({},this.currentTextConfig),e)}createLabel(e={text:""}){return new s.$(Object.assign(Object.assign({},this.currentTextConfig),e))}static makeConfig(e){return Object.assign(Object.assign({},this.defaultTextConfig),e)}}Label3DFactory.defaultTextConfig={text:"",align:"center",wordWrapWidth:void 0,color:"black",backgroundColor:"white",backgroundBorderWidth:50,backgroundBorderHeight:30,background:!0,backgroundAsCollider:!0,backgroundColliderType:r.Mesh,scale:1,outline:!1,outlineWidth:4}},45576:e=>{e.exports="precision highp float;precision highp int;uniform sampler2D map;uniform vec3 color;uniform float opacity;varying vec2 vUv;void main(){vec4 sample=texture2D(map,vUv).rgba;gl_FragColor=vec4(sample.rgb*color.rgb,clamp(sample.a*opacity,0.,1.));}"},60948:e=>{e.exports="precision highp float;precision highp int;attribute vec2 uv;attribute vec4 position;uniform mat4 projectionMatrix;uniform mat4 modelViewMatrix;varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*position;}"}}]);